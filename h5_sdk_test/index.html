<%--
  Created by IntelliJ IDEA.
  User: Admin
  Date: 2023/7/11
  Time: 11:33
  To change this template use File | Settings | File Templates.
--%>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
<script src="https://accounts.google.com/gsi/client" async></script>
<script>

    var isFBSuc = false;

    function facebookinit(){
        FB.init({
            appId            : '940773713487256',
            autoLogAppEvents : true,
            xfbml            : true,
            version          : 'v17.0'
        });
        isFBSuc = true;
    }

    function facebookLogin(){

        if(!isFBSuc){
            document.getElementById("text").innerText = "facebook 没有初始化";
            return;
        }

        FB.login(function(response) {
            console.log('response:'+response.toString());
            console.log('status:'+response.status);
//            console.log('status:'+response.authResponse.accessToken);
//            console.log('status:'+response.authResponse.userID);
            //console.log('status:'+response.status);
            if (response.authResponse) {
                console.log('Welcome!  Fetching your information.... ');
                FB.api('/me', function(response) {
                    document.getElementById("text").innerText = 'Good to see you, ' + response.name + '.';
                });
            } else {
                console.log('User cancelled login or did not fully authorize.');
            }
        }, {scope: 'public_profile,email'});
    }

    function facebookLoout(){
        FB.logout(function(response) {
            // Person is now logged out
        });
    }

    function getState(){
        FB.getLoginStatus(function(response) {
            console.log('status:'+response.status);
            if(response.status==="connected"){
                document.getElementById("text").innerText ="facebook 已登录；accesstoken: "+ response.authResponse.accessToken;
            }else{
                document.getElementById("text").innerText = "facebook 暂未登录";
            }
//            console.log('status:'+response.authResponse.accessToken);
            //statusChangeCallback(response);
        })
    }

    function handleCredentialResponse(response){
        //var idToken = response.getAuthResponse().id_token;
        console.log("ID: " + "aaaaaaaaaaaaaaaaaaaaaaaaa");
        console.log("ID: " + response.credential);
        const responsePayload = decodeJWT(response.credential);
        console.log('头部:', responsePayload.header);
        console.log('负载:', responsePayload.payload);
        document.getElementById("text").innerText ='Google登录:'+responsePayload.payload.name;
//        console.log("ID: " + responsePayload.sub);
//        console.log('Full Name: ' + responsePayload.name);
//        console.log('Given Name: ' + responsePayload.given_name);
//        console.log('Family Name: ' + responsePayload.family_name);
//        console.log("Image URL: " + responsePayload.picture);
//        console.log("Email: " + responsePayload.email);
    }

    function google_init(){
        google.accounts.id.initialize({
            client_id: '550948425386-0dm4gski8f5evdgvts3klqpp54n07h5s.apps.googleusercontent.com',
            callback: handleCredentialResponse
        });
        google.accounts.id.prompt();
//        google.accounts.id.disableAutoSelect();

//        google.accounts.id.renderButton(
//                document.getElementById("buttonDiv"),
//                { theme: 'outline', size: 'large' }
//        );
    }

    function decodeJWT(jwt) {
        // 将 JWT 的有效载荷部分分割为头部、负载和签名
        var parts = jwt.split('.');
        var header = parts[0];
        var payload = parts[1];
        var signature = parts[2];

        // 解码头部和负载
        var decodedHeader = JSON.parse(atob(header));
        var decodedPayload = JSON.parse(atob(payload));

        // 返回解码后的头部和负载
        return {
            header: decodedHeader,
            payload: decodedPayload
        };
    }

</script>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>这是一个demo</title>
      <button type="button"  onclick="facebookinit()">facebook初始化</button>
      <button type="button"  onclick="getState()">facebook获取状态</button>
      <button type="button"  onclick="facebookLogin()">facebook登录</button>
      <button type="button"  onclick="facebookLoout()">facebook登出</button>

      <div>
          <button type="button" onclick="google_init()">google 一键登录</button>

      </div>

      <%--<div id="g_id_onload"--%>
           <%--data-client_id="550948425386-0dm4gski8f5evdgvts3klqpp54n07h5s.apps.googleusercontent.com"--%>
           <%--data-context="signin"--%>
           <%--data-ux_mode="popup"--%>
           <%--data-callback="handleCredentialResponse"--%>
           <%--data-auto_prompt="false">--%>
      <%--</div>--%>

      <%--<div class="g_id_signin"--%>
           <%--data-type="standard"--%>
           <%--data-shape="rectangular"--%>
           <%--data-theme="outline"--%>
           <%--data-text="signin_with"--%>
           <%--data-size="large"--%>
           <%--data-logo_alignment="left">--%>
      <%--</div>--%>

      <%--<div id="g_id_onload"--%>
           <%--data-client_id="550948425386-0dm4gski8f5evdgvts3klqpp54n07h5s.apps.googleusercontent.com"--%>
           <%--data-callback="handleCredentialResponse">--%>
      <%--</div>--%>
      <%--<div id="buttonDiv"></div>--%>
      <p id="text" style="color: red"></p>
  </head>
  <body>

  </body>
</html>
